{"version":3,"sources":["login.js"],"names":[],"mappings":"AAAA,IAAI,UAAU,QAAQ,SAAR,CAAd;AACA,IAAI,SAAS,QAAQ,MAAR,EAAb;AACA,MAAM,QAAQ,QAAQ,sBAAR,CAAd;AACA;;AAEA,SAAS,SAAT,CAAmB,MAAnB,EAA2B;AAC1B,KAAI,OAAO,MAAP,KAAkB,QAAtB,EAAgC;AAC/B,SAAO,KAAP;AACA,EAFD,MAEO;AACN,SAAO,IAAP;AACA;AACD;;AAGD;AACA,OAAO,IAAP,CAAY,GAAZ,EAAiB,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AACzC,OAAM,SAAS,IAAI,IAAJ,CAAS,MAAxB;AACA,OAAM,WAAW,IAAI,IAAJ,CAAS,IAA1B;AACA,KAAG,CAAC,UAAU,MAAV,CAAJ,EAAuB;AACtB,SAAO,IAAI,IAAJ,CAAS,EAAE,SAAS,MAAX,EAAmB,KAAK,MAAxB,EAAT,CAAP;AACA;AACD,KAAG,IAAI,OAAJ,CAAY,MAAZ,KAAuB,SAA1B,EAAqC;AACpC,MAAI,OAAJ,CAAY,UAAZ,CAAuB,YAAU;AAC7B,OAAI,IAAJ,GAAW;AACV,YAAQ,MADE;AAEV,cAAU;AAFA,IAAX;AAIA,OAAI,OAAJ,CAAY,MAAZ,GAAqB,MAArB;AACA,OAAI,OAAJ,CAAY,IAAZ,GAN6B,CAMR;AACtB,GAPH;AAQA,QAAM,OAAN,CAAc,MAAd,EACC,IADD,CACO,IAAD,IAAU;AACf,OAAG,CAAC,KAAK,MAAT,EAAiB;AAChB,WAAO,MAAM,MAAN,CAAa,IAAI,IAAjB,CAAP;AACA,IAFD,MAEO;AACN,QAAI,IAAJ,CAAS,EAAE,SAAS,SAAX,EAAT;AACA;AACD,GAPD,EAQC,IARD,CAQO,IAAD,IAAU;AACf,OAAI,IAAJ,CAAS,EAAE,SAAS,IAAX,EAAT;AACA,GAVD;AAWA,EApBD,MAoBO;AACN,MAAI,IAAJ,CAAS,EAAE,SAAS,SAAX,EAAT;AACA;AACD,CA7BD;;AA+BA,OAAO,OAAP,GAAiB,MAAjB","file":"login-compiled.js","sourcesContent":["var express = require('express');\nvar router = express.Router();\nconst users = require('./../controller/user');\n// const userController = require('./../controller/user');\n\nfunction checkUser(userId) {\n\tif (typeof userId !== 'number') {\n\t\treturn false;\n\t} else {\n\t\treturn true;\n\t}\n}\n\n\n//login、\nrouter.post('/', function(req, res, next) {\n\tconst userId = req.body.userId;\n\tconst username = req.body.name;\n\tif(!checkUser(userId)) {\n\t\treturn res.json({ 'login': 'fail', msg: '类型错误'});\n\t}\n\tif(req.session.userId === undefined) {\n\t\treq.session.regenerate(function(){\n      req.user = {\n      \tuserId: userId,\n      \tusername: username\n      };\n      req.session.userId = userId;\n      req.session.save();  //保存一下修改后的Session\n    });\n\t\tusers.hasUser(userId)\n\t\t.then((user) => {\n\t\t\tif(!user.length) {\n\t\t\t\treturn users.insert(req.user)\n\t\t\t} else {\n\t\t\t\tres.json({ 'login': 'success' });\n\t\t\t}\n\t\t})\n\t\t.then((data) => {\n\t\t\tres.json({ 'login': data });\n\t\t}) \n\t} else {\n\t\tres.json({ 'login': 'success' });\n\t}\n});\n\nmodule.exports = router;\n"]}